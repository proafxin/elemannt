\documentclass[elemannt.tex]{subfile}

\begin{document}
	\chapter{Two Elementary Proofs of Legendre-Dirichlet Prime Number Theorem}\label{ch:legendre}
	\textcite[pp. 241]{euler_1783} proved that the sequence ${a+nd}$ contains infinitely many primes for $a=1$. This can be proven using cyclotomic polynomials (see \textcite[$\S1.4$, Theorem 1.47]{billal_riasat_2021}). \textcite[pp. 404]{legendre_1798} conjectured that ${a+nd}$ contains infinitely many primes when $\gcd(a,d)=1$ although failed to prove it as \textcite[$\S29$, pp. $505-508$]{gauss_1801} noted. \textcite{dirichlet_1837} proved in his famous paper that $a+nd$ contains infinitely many primes though the proof is complete only when $d$ is a prime. \textcite{dirichlet_1839} (also see \textcite{dirichlet_1897_28}) completes this proof with Dirichlet's class number formula. This is why today it is known as \index{Dirichlet's theorem on arithmetic progression}\textit{Dirichlet's theorem on arithmetic progression} or \textit{Dirichlet's prime number theorem}.
	\section{Dirichlet Characters}
	Dirichlet's idea of proving Legendre's conjecture essentially comes from Euler's proof of the divergence of the sum of reciprocal of primes, except Dirichlet wanted to prove the same when restricted by the constraint that $p\equiv a\pmod{k}$. Euler's proof gives us another way to prove there are infinitely many primes because the sum of reciprocals of primes diverge. If there were finitely many primes, that would not be the case. So, if we could prove
		\begin{align*}
			\sum_{p\equiv a\pmod{k}}\frac{1}{p}
		\end{align*}
	diverges as well, the theorem would be complete. This is where Dirichlet introduced the crucial idea of \textit{characters}. The motivation Dirichlet had was to define a \textit{periodic} function in a certain way that would allow one to
		\begin{enumerate}
			\item differentiate when $a$ is relatively prime to $k$.
			\item behaves the same as the reduced set of residues $\pmod{k}$.
			\item behaves the same as the complex roots of unity (this is actually very important, for example, the sum of all roots of unity is $0$.)
			\item can differentiate when $b\equiv a\pmod{k}$ for $\gcd(a,k)=1$.
		\end{enumerate}
	The intuition behind finding a periodic function is to note that $\gcd(a,k)=1$ implies $\gcd(a+k,k)=1$. As we will see later, Dirichlet characters satisfy all of these properties. It will become apparent later how and why they play such a crucial role. \textcite[pp. 186]{legendre_1798} defined the \textit{Legendre symbol} which plays a pivotal role in elementary number theory. \textcite{jacobi_1846} generalized Legendre symbol which is now known as \textit{Jacobi symbol}. \textcite[pp. 770]{kronecker_1885} generalized this to \textit{Kronecker symbol} which is unfortunately less known today. This is because \textcite{dirichlet_1837} had already introduced (also see \textcite{dirichlet_1897_21}) a generalization of Kronecker symbol which is far more insightful. Let $k$ be a fixed positive integer throughout this chapter.
		\begin{definition}[Dirichlet Character]
			An arithmetic function $\chi$ is called a \index{Dirichlet character}\textit{character} $\pmod{k}$ if
				\begin{enumerate}
					\item $\chi(a)=0$ if $\gcd(a,k)>1$.
					\item $\chi(1)\neq0$.
					\item $\chi(ab)=\chi(a)\chi(b)$ for all positive integers $a,b$.
					\item $\chi(a)=\chi(b)$ if $a\equiv b\pmod{k}$.
				\end{enumerate}
		\end{definition}
	Note that Legendre symbol $\qr{a}{p}$ for prime $p$, Jacobi symbol $\qr{a}{n}$ and Kronecker symbol $\qr{a}{l}$ are all characters $\pmod{p},\pmod{n}$ and $\pmod{l}$ respectively where $p$ is prime, $n$ is a positive integer and $l\equiv0,1\pmod{4}$ for square-free $l$. Another example of $\chi$ is $\chi(n)=0$ for $n\equiv0,2\pmod{4}$, $\chi(n)=1$ for $n\equiv1\pmod4$ and $\chi(n)=-1$ for $n\equiv3\pmod{4}$. Obviously, $\chi$ is completely multiplicative; hence $\chi(1)=1$.

	It is still not entirely clear how $\chi$ satisfies the properties we mentioned above. The next three theorems show why $\chi(n)$ behaves like complex roots of unity.
		\begin{proposition}
			If $\gcd(n,k)=1$, then $\chi(n)^{\varphi(k)}=1$. So $\chi(n)$ is actually a complex number which is an $\varphi(k)$-th root of unity and $|\chi(n)|=1$.
		\end{proposition}

		\begin{proof}
			From Euler's theorem,
				\begin{align*}
					n^{\varphi(k)}
						& \equiv1\pmod{k}
				\end{align*}
			So, $\chi(n)^{\varphi(k)}=\chi(n^{\varphi(k)})=\chi(1)=1$.
		\end{proof}

		\begin{definition}[Principal character]
			$\chi_{0}(n)=1$ when $\gcd(n,k)=1$ is the \textit{principal character} $\pmod{k}$. If $\gcd(n,k)>1$, $\chi_{0}(n)=0$.
		\end{definition}
	Since the characters $\pmod{k}$ are complex roots of unity, the complex conjugate of $\chi(n)$, $\bar{\chi(n)}$ is also a root of unity, hence; the following.
		\begin{proposition}
			If $\chi(n)$ is a character $\pmod{k}$, $\bar{\chi(n)}$ is also a character $\pmod{k}$.
		\end{proposition}

		\begin{proposition}\label{pro:sum-for-residues}
			For any Dirichlet character $\chi$,
				\begin{align*}
					\sum_{0\leq a\leq k-1}\chi(a)
						& =
							\begin{cases}
								\varphi(k)& \mbox{ if }\chi=\chi_{0}\\
								0& \mbox{ otherwise}
							\end{cases}
				\end{align*}

		\end{proposition}

		\begin{proof}
			If $\chi(n)=\chi_{0}(n)$ is the principal character, then
				\begin{align*}
					\sum_{i=0}^{k-1}\chi_{0}(i)
						& = \sum_{\substack{i=0\\\gcd(i,k)=1}}^{k-1}\chi_{0}(i)+\sum_{\substack{i=0\\\gcd(i,k)>1}}^{k-1}\chi_{0}(i)\\
						& = \sum_{\substack{i=0\\\gcd(i,k)=1}}^{k-1}1\\
						& = \varphi(k)
				\end{align*}
			If $\chi(n)$ is not the principal character, for any $l$ prime to $k$ such that $\chi(l)\neq1$, the set of residues $\{i: 1\leq i\leq k-1\}$ and $\{il:1\leq i\leq k-1\}$ coincide. Then
				\begin{align*}
					\sum_{i=1}^{k-1}\chi(i)
						& = \sum_{i=1}^{k-1}\chi(il)\\
						& = \sum_{i=1}^{k-1}\chi(i)\chi(l)\\
						& = \chi(l)\sum_{i=1}^{k-1}\chi(i)
				\end{align*}
			Since $\chi(l)\neq1$,
				\begin{align*}
					\sum_{i=1}^{k-1}\chi(i)
						& = 0
				\end{align*}
		\end{proof}
	The next two theorems show why $\chi$ behaves like a complete/reduced set of residues.
		\begin{proposition}\label{pro:product-character}
			If $\chi_{1}(n)$ and $\chi_{2}(n)$ are both characters, then so is $\chi_{1}(n)\chi_{2}(n)$.
		\end{proposition}

		\begin{proof}
			Left as an exercise.
		\end{proof}

		\begin{proposition}\label{pro:char-perm}
			If $\chi'(n)$ is a character and $\chi(n)$ runs over all characters of $k$, $\chi'(n)\chi(n)$ runs over all characters of $k$ as well.
		\end{proposition}

		\begin{proof}
			If $\gcd(n,k)\neq1$, $\chi'(n)\chi(n)$ and $\chi(n)$ both are $0$. For $\gcd(n,k)=1$, if $\chi'(n)\chi(n)=\chi''(n)\chi'(n)$ then $\chi(n)=\chi''(n)$ since neither is $0$. By \autoref{pro:product-character}, $\chi(n)\chi'(n)$ produces $\varphi(k)$ different characters so are a permutation of the original characters $\chi'(n)$.
		\end{proof}

		\begin{proposition}\label{pro:char-not-one}
			If $a$ is a positive integer prime to $k$ such that $a\not\equiv1\pmod{k}$, then there exists a character $\chi(a)\neq1$.
		\end{proposition}

		\begin{proof}
			If $p$ is a prime divisor of $k$ and $k=p^{e}l$ such that $p\nmid l$ then $p\nmid a$. For any $e$, there exists a primitive $\lambda(p^{e})$-th root $g\pmod{p^{e}}$ where $\lambda(n)$ is Carmichael's universal exponent function (see \textcite[pp. 90]{billal_riasat_2021}). For any $a$ not divisible by $p$, there is a unique non-negative integer $u$ not exceeding $\lambda(p^{e})$ such that
				\begin{align*}
					a
						& \equiv g^{u}\pmod{p^{e}}
				\end{align*}
			Setting $\zeta:=\exp\left(\frac{2i\pi}{\lambda(p^{e})}\right)$ and $\chi(a)=\zeta^{u}$, we can easily see for $a\equiv g^{u}\pmod{p^{e}}$ and $b\equiv g^{v}\pmod{p^{e}}$,
				\begin{align*}
					ab
						& \equiv g^{u+v}\pmod{p^{e}}\\
					\chi(ab)
						& = \zeta^{u+v}\\
						& =\zeta^{u}\zeta^{v}\\
						& = \chi(a)\chi(b)
				\end{align*}
			The other properties are trivially satisfied. Now it remains to see that for $a\not\equiv1\pmod{k}$, if $a\equiv g^{u}\pmod{p^{e}}$ then $\lambda(p^{e})\nmid u$ so $\zeta^{u}\neq1$.
		\end{proof}

		\begin{proposition}\label{pro:sum-for-char}
			If $C(k)$ is the number of characters $\pmod{k}$, then
				\begin{align*}
					\sum_{\chi}\chi(a)
						& =
							\begin{cases}
								C(k)\mbox{ if }a\equiv1\pmod{k}\\
								0\mbox{ otherwise}
							\end{cases}
				\end{align*}
			where the sum ranges through all the characters.
		\end{proposition}

		\begin{proof}
			If $a\equiv1\pmod{k}$,
				\begin{align*}
					\sum_{\chi}\chi(a)
						& = \sum_{\chi}1\\
						& = C(k)
				\end{align*}
			If $\gcd(a,k)>1$, then $\chi(a)=0$ for all $\chi$ so $\sum_{\chi}\chi(a)=0$. Now, $\gcd(a,k)=1$ and $a\not\equiv1\pmod{k}$. By \autoref{pro:char-not-one}, there is a character $\chi'$ such that $\chi'(a)\neq1$. By \autoref{pro:char-perm},
				\begin{align*}
					\sum_{\chi}\chi(a)
						& = \sum_{\chi}\chi(a)\chi'(a)
				\end{align*}
			Since $\chi'(a)\neq1$, we have $\sum_{\chi}\chi(a)=0$.
		\end{proof}

		\begin{proposition}
			There are $\varphi(k)$ characters $\pmod{k}$.
		\end{proposition}

		\begin{proof}
			If $\chi$ runs through all the characters, by \autoref{pro:sum-for-char}
				\begin{align*}
					\sum_{i=0}^{k-1}\sum_{\chi}\chi(i)
						& = 0+\sum_{\chi}\chi(1)+\sum_{i=2}^{k-1}\sum_{\chi}\chi(i)\\
						& = C(k)
				\end{align*}
			On the other hand, by \autoref{pro:sum-for-residues}
				\begin{align*}
					\sum_{i=0}^{k-1}\sum_{\chi}\chi(i)
						& = \sum_{i=0}^{k-1}\chi_{0}(i)+\sum_{i=0}^{k-1}\sum_{\substack{\chi\\\chi\neq\chi_{0}}}\chi(i)\\
						& = \varphi(k)
				\end{align*}
			Thus, $C(k)=\varphi(k)$.
		\end{proof}

		\begin{proposition}\label{prop:moduluscharacter}
			Let $l$ be a positive integer prime to $k$. Then for a positive integer $a$,
				\begin{align*}
					\sum_{\chi}\dfrac{\chi(a)}{\chi(l)}
						& =
							\begin{cases}
								\varphi(k)\mbox{ if }a\equiv l\pmod{k}\\
								0\mbox{ otherwise}
							\end{cases}
				\end{align*}
		\end{proposition}

		\begin{proof}
			Let $t$ be a positive integer such that $lt\equiv1\pmod{k}$. Such $t$ exists since $l$ is prime to $k$. Then $\chi(l)\chi(t)=\chi(lt)=\chi(1)=1$.
				\begin{align*}
					\sum_{\chi}\dfrac{\chi(a)}{\chi(l)}
						& = \sum_{\chi}\chi(a)\chi(t)\\
						& = \sum_{\chi}\chi(at)
				\end{align*}
			According to \autoref{pro:sum-for-residues}, if $at\equiv1\pmod{k}$, then $\sum_{\chi}\chi(at)=\varphi(k)$ otherwise $\sum_{\chi}\chi(at)=0$. Since $at\equiv1\equiv lt\pmod{k}$ and $\gcd(t,k)=1$, we have $a\equiv l\pmod{k}$.
		\end{proof}

		\begin{definition}
			$\chi$ is a \textit{character of the first kind} if $\chi=\chi_{0}$ is the principal character. If $\chi$ is real but not principal, then $\chi$ is a \textit{character of the second kind}. Otherwise, $\chi$ can sometimes be complex and called \textit{character of the third kind}.
		\end{definition}
	The next result is a very crucial one and was the intuition behind defining a function like $\chi$ with the properties we discussed.
		\begin{proposition}\label{prop:sumphi/2}
			If $\chi$ is not a character of the first kind, then $\sum_{i=a}^{b}\chi(i)\leq \frac{\varphi(k)}{2}$ for $1\leq a\leq b$.
		\end{proposition}

		\begin{proof}
			Notice that, $\sum_{i=0}^{k-1}\chi(i)=0$ if $\chi$ is not of the first kind. So we can only consider $1\leq a\leq b\leq a+k-1$. Also, $|\chi(a)|=1$ for $\varphi(k)$ residues that prime to $k$. If the number of residues $i$ for which $|\chi(i)|=1$ and $a\leq i\leq b$ does not exceed $\frac{\varphi(k)}{2}$, then we are done. Otherwise, there are more than $\frac{\varphi(k)}{2}$ residues $i$ for which $|\chi(i)|=1$ and $a\leq i\leq b$. In that case, the number of residues $i$ for which $|\chi(i)|=1$ and $b+1\leq i\leq a+k-1$ does not exceed $\frac{\varphi(k)}{2}$.
				\begin{align*}
					\sum_{i=a}^{b}\chi(a)
						& = \sum_{i=a}^{a+k-1}\chi(i)-\sum_{i=b+1}^{a+k-1}\chi(i)
				\end{align*}
			Since $\sum_{i=a}^{a+k-1}\chi(i)=0$,
				\begin{align*}
					\left|\sum_{i=a}^{b}\chi(a)\right|
						& = \left|\sum_{i=b+1}^{a+k-1}\chi(i)\right|\\
						& < \frac{\varphi(k)}{2}
				\end{align*}
		\end{proof}

	We now prove a very insightful result.
		\begin{proposition}\label{prop:lsumlimited}
			Let $\chi$ be a character of the second or third kind $\pmod{k}$ and $f$ be a function such that $f(x)\geq 0$ and $f'(x)$ is continuous for all $x\geq x_{0}$ for some positive $x_{0}$. Then
				\begin{align*}
					\sum_{a< n\leq b}\chi(n)f(n)
						& = \bigo{f(a)}
				\end{align*}
		\end{proposition}
	When I said earlier that it would become apparent how someone would think of functions likes characters, this lemma was one of the results I had in my mind. Let $P(x)$ denote the set of primes not exceeding $x$. If for a positive integer $n>1$, $P_{a}(x, n)$ is the set of primes not exceeding that are $a\pmod{n}$ and $r_{1},\ldots,r_{\varphi(n)}$ are the numbers prime to $n$ not exceeding $n$, then obviously $P(x)=P_{r_{1}}(x,n)\cup\ldots P_{r_{\varphi(n)}}(x,n)$ where $P_{i}(x,n)$ and $P_{j}(x,n)=\{\}$ are disjoint if $i\neq j$. Now, we know that there are infinitely many primes to $P(x)\to\infty$ as $x\to\infty$. So, it is highly likely we also have $P_{a}(x,n)\to\infty$ for fixed $a$ and $n$ as well. However, we need to somehow sift them out in a way that allows us to retain only primes of the form $a\pmod{n}$. Imagine something like this: we already know $\sum_{p\leq x}1\to\infty$ and we want to show $\sum_{\substack{p\leq x\\p\equiv a\pmod{n}}}1\to\infty$ as $x\to\infty$. What if we could somehow relate these two? In order to do that, we should definitely look at something like $\sum_{p\leq x}f(a,p)$ where $f(a,p)$ would be $0$ unless $p\equiv a\pmod{n}$. Again, it is very difficult to get an idea how to exactly handle this directly. One thing we could do is to consider something like $\sum_{p\leq x}f(a,p)g(p)$ where $g(p)$ would be known to us and we would have a good idea about both $\sum_{p\leq x}g(p)$. Then if we somehow had an estimation for $\sum_{p\leq x}f(a,p)g(p)$ itself, we could single out $\sum_{p\leq x}f(a,p)$ itself by using something like \nameref{thm:abel}. Now, clearly, we want $f(a,p)=1$ when $p\equiv a\pmod{n}$ otherwise $f(a,p)=0$. In order to be able to use \nameref{thm:abel}, we should consider something like $\sum_{n\leq x}f(a,n)$. Now, since we only want primes we must also have $f(a,n)=0$ whenever $\gcd(a,n)>1$. Another crucial intuition is that we can be certain $\sum_{\substack{p\leq x\\p\equiv a\pmod{n}}}$ would be surely related to $\sum_{p\leq x}1$, most likely bounded by a factor. In other words, we are conjecturing $\sum_{\substack{p\leq x\\p\equiv a\pmod{n}}}=\func{O}{\sum_{p\leq x}1}$. Obviously, this will turn out to be true, but we are pretending we still do not know if it is true or false. Then we should look for a function that can make $\sum_{p\leq x}f(a,p)g(p)$ disappear except for a few cases. This suggests us that the partial sums $\sum_{n\leq x}f(a,n)$ should be bounded, in other words we should look for functions that would give us $\sum_{y\leq n\leq x}f(a,n)=O(1)$ ideally. This might be a little too much too ask for, so we could even look for something like $\sum_{y\leq n\leq x}f(a,n)g(n)$ to be bounded by $g(x)$ so $\sum_{y\leq n\leq x}f(a,n)g(n)=\func{O}{g(x)}$ would also be desirable. This is where the idea of complex roots come. If you recall, the sum of non-unit complex roots vanishes. Therefore, we should definitely look into sort of one to one correspondence of complex roots. This actually makes more sense if you recall that the only root that does not contribute to the vanishing sum is $1$. This all sounds a bit handwavy so we will now jump into the formal proof again.
		\begin{proof}
			Since $\chi$ is non-principal,
				\begin{align*}
					\sum_{i=1}^{k-1}\chi(i)
						& = 0
				\end{align*}
			In \nameref{thm:abel}, setting $a_{n}:=\chi(n)$, we have $A(k)=0$. By periodicity, $A(nk)=0$ for all positive integer $n$. Thus, if $\floor{x}=kq+r$ with $0\leq r<k$, $A(x)=A(r)<\varphi(k)$ so $A(x)=O(1)$.
				\begin{align*}
					\sum_{a< n\leq b}\chi(n)f(n)
						& = A(b)f(b)-A(a)f(a)-\int_{a}^{b}A(t)f'(t)dt\\
						& = \bigo{f(b)}-\bigo{f(a)}-\bigo{\int_{a}^{b}f'(t)dt}\\
						& = \bigo{f(a)}
				\end{align*}
		\end{proof}
	Since $\lim_{b\to\infty}\sum_{a<n\leq b}\chi(n)f(n)=\sum_{n\geq 1}\chi(n)f(n)-\sum_{n\leq a}\chi(n)f(n)$, we have the following.
		\begin{proposition}\label{pro:o(f)}
			If $\lim_{x\to\infty}f(x)=0$, then
				\begin{align*}
					\sum_{n\leq a}\chi(n)f(n)
						& = \sum_{n\geq 1}\chi(n)f(n)+\bigo{f(a)}
				\end{align*}
		\end{proposition}
	\section{Dirichlet's \textit{L}-Series}
	We mentioned earlier that Riemann considered $\zeta(s)$ for complex $s$. Here, we do something similar except we do not require any complex analysis except for the most basic facts.
		\begin{definition}[$L$-Series]
			Let $s$ be a complex number. If $k$ is a positive integer and $\chi$ is a character $\pmod{k}$, Dirichlet's $L$-series $L(s, \chi)$ associated with $\chi$ and $s$ is defined as
				\begin{align*}
					L(s, \chi)
						& = \sum_{a\geq 1}\dfrac{\chi(a)}{a^{s}}
				\end{align*}
		\end{definition}
	So, $L$-series is the \nameref{def:euler-product} when $f(n):=\chi(n)$. Since $\chi$ is completely multiplicative, using properties of Euler product, we immediately have the following.
		\begin{proposition}
			For a complex $s$ and a character $\chi$,
				\begin{align*}
					L(s, \chi)
						& = \prod_{p}\dfrac{1}{1-\dfrac{\chi(p)}{p^{s}}}
				\end{align*}
		\end{proposition}

		\begin{proposition}
			For any of $\varphi(k)$ characters $\chi$ and complex number $s$ with $\mathfrak{R}(s)>1$, $L(s, \chi)$ converges.
		\end{proposition}

		\begin{proof}
			For a complex number $s=\sigma+it$ and $a=e^{b}$, $|a^{s}|=a^{\sigma}|a^{it}|=a^{\sigma}|e^{bit}|$. Since $e^{ix}=\cos{x}+i\sin{x}$, $|e^{ix}|=\cos^{2}{x}+\sin^{2}{x}=1$. Thus, $|a^{s}|=a^{\sigma}$ and by triangle inequality,
				\begin{align*}
					|L(s, \chi)|
						& \leq \abslarge{\sum_{a\geq 1}\dfrac{\chi(a)}{a^{s}}}\\
						& \leq \sum_{a\geq 1}\abslarge{\dfrac{\chi(a)}{a^{s}}}\\
						& = \sum_{a\geq 1}\dfrac{|\chi(a)|}{a^{\sigma}}\\
						& \leq \sum_{a\geq 1}\dfrac{1}{a^{\sigma}}\\
						& = \zeta(\sigma)
				\end{align*}
			If $\sigma > 1$, then $\zeta(\sigma)$ converges, hence, so does $L(s, \chi)$.
		\end{proof}

		\begin{proposition}\label{prop:nonprincipaldirichletconverges}
			For a non-principal $\chi$, $L'(s, \chi)$ converges for $s>1$.
		\end{proposition}

		\begin{proof}
			This is comparatively easy to prove now using \autoref{prop:sumphi/2}.
		\end{proof}

		\begin{proposition}\label{pro:second-char-geq1}
			If $\chi$ is a character of the second kind and
				\begin{align*}
					\varsigma(n)
						& = \sum_{d\mid n}\chi(d)
				\end{align*}
			Then $\varsigma(n)\geq 0$ for all $n$ and $\varsigma(n)\geq 1$ for square $n$.
		\end{proposition}

		\begin{proof}
			Since $\chi$ is completely multiplicative and $\varsigma$ is the summatory function on divisors, $\varsigma$ is multiplicative also. So we mainly need to look at
				\begin{align*}
					\varsigma(p^{e})
						& = \sum_{d\mid p^{e}}\chi(d)\\
						& = 1+\sum_{i=1}^{e}\chi(p^{i})\\
						& = 1+\sum_{i=1}^{e}(\chi(p))^{i}
				\end{align*}
			If $\chi(p)=0$, then $\varsigma(p^{e})=1$. If $\chi(p)=1$, then $\varsigma(p^{e})=e+1$. Otherwise $\chi(p)=-1$ so $\varsigma(p^{e})=1$ if $e$ is even or $\varsigma(p^{e})=0$ if $e$ is odd. If $n=p_{1}^{e_{1}}\cdots p_{r}^{e_{r}}$, then $\varsigma(n)=\varsigma(p_{1}^{e_{1}})\cdots\varsigma(p_{r}^{e_{r}})$. Since each $\varsigma(p_{i}^{e_{i}})\geq0$, we have $\varsigma(n)\geq0$ and if $n$ is square, then $e_{i}$ is even for $1\leq i\leq r$ so $\varsigma(p_{i}^{e_{i}})\geq 1$ and $\varsigma(n)\geq1$.
		\end{proof}

		\begin{proposition}\label{prop:non-vanising-second}
			If $\chi$ is of the second kind, then $L(1,\chi)\neq0$.
		\end{proposition}
	The proofs of $L(1, \chi)\neq0$ for different kinds of $\chi$ presented here are primarily due to \textcite[Chapters 6]{apostol_1976} and \textcite[Theorems 150-151]{landau_1969}. \textcite[pp. 121, Theorem 152]{landau_1969} says the following about this theorem:
		\begin{quote}
			This is the deepest of all of the lemmas that are necessary for Dirichlet's proof. Dirichlet proved it only by the considerably roundabout method of using the so-called theory of the class number of quadratic forms.
		\end{quote}
	 The reader is encouraged to try and prove \autoref{prop:non-vanising-second}. For example, a question is whether \nameref{thm:abel} works here with the following decomposition or not:
		\begin{align*}
			\sum_{n\leq x}\dfrac{\chi(n)}{n}
				& = \sum_{n\leq x}\dfrac{\chi(n)}{\sqrt{n}}\dfrac{1}{\sqrt{n}}
		\end{align*}
	Then taking $x\to\infty$ seems very promising but there is a catch. Figuring out this catch is left to the reader as an exercise.
		\begin{proof}
			Let
				\begin{align*}
					\Upsilon(x)
						& = \sum_{n\leq x}\dfrac{\varsigma(n)}{\sqrt{n}}
				\end{align*}
			By \autoref{pro:second-char-geq1}, $\varsigma(n)\geq 1$ for square $n$, so
				\begin{align*}
					\Upsilon(x)
						& \geq \sum_{n\leq\sqrt{x}}\dfrac{1}{n}
				\end{align*}
			Clearly $\Upsilon(x)\to\infty$ as $x\to\infty$. Now,
				\begin{align*}
					\Upsilon(x)
						& = \sum_{n\leq x}\dfrac{\sum_{d\mid n}\chi(d)}{\sqrt{n}}\\
						& = \sum_{de\leq x}\dfrac{\chi(d)}{\sqrt{de}}
				\end{align*}
			We can use \nameref{thm:hyperbola} with $a=b=\sqrt{x}, f(n)=\frac{\chi(n)}{\sqrt{n}}$ and $g(n)=\frac{1}{\sqrt{n}}$.
				\begin{align*}
					\Upsilon(x)
						& = \sum_{n\leq\sqrt{x}}\dfrac{\chi(n)}{\sqrt{n}}\func{G}{\dfrac{x}{n}}+\sum_{n\leq \sqrt{x}}\dfrac{1}{\sqrt{n}}\func{F}{\dfrac{x}{n}}-F(\sqrt{x})G(\sqrt{x})
				\end{align*}
			where $F(x)=\sum_{n\leq x}f(n)$ and $G(x)=\sum_{n\leq x}g(n)$. Setting $f(n):=\frac{1}{\sqrt{n}}$ in \autoref{pro:o(f)},
				\begin{align*}
					\sum_{n\leq x}\dfrac{\chi(n)}{\sqrt{n}}
						& = \sum_{n\geq 1}\dfrac{\chi(n)}{\sqrt{n}}+\bigo{\dfrac{1}{\sqrt{x}}}
				\end{align*}
			From \nameref{thm:cauchyconvergence}, we can see that
				\begin{align*}
					\sum_{n\geq 1}\dfrac{\chi(n)}{\sqrt{n}}
				\end{align*}
			converges. Since $\lim_{x\to\infty}\frac{1}{\sqrt{x}}=0$, $F(x)=C+\bigo{\frac{1}{\sqrt{x}}}$. Setting $s:=\frac{1}{2}$ in \autoref{thm:zetapositive},
				\begin{align*}
					G(x)
						& =2\sqrt{x}+D+\bigo{\frac{1}{\sqrt{x}}}
				\end{align*}
			Using these, we get
				\begin{align*}
					\Upsilon(x)
						& = \sum_{n\leq \sqrt{x}}\dfrac{1}{\sqrt{n}}\func{}{\chi(n)\func{}{2\sqrt{\dfrac{x}{n}}+D+\bigo{\sqrt{\dfrac{n}{x}}}+C+\bigo{\sqrt{\dfrac{n}{x}}}}}-F(\sqrt{x})G(\sqrt{x})\\
						& = 2\sqrt{x}\sum_{n\leq \sqrt{x}}\dfrac{\chi(n)}{n}+D\sum_{n\leq \sqrt{x}}\dfrac{\chi(n)}{\sqrt{n}}+\dfrac{1}{\sqrt{x}}\bigo{\sum_{n\leq \sqrt{x}}\chi(n)}\\
						& +C\sum_{n\leq \sqrt{x}}\dfrac{1}{\sqrt{n}}+\dfrac{1}{\sqrt{x}}\bigo{\sum_{n\leq \sqrt{x}}1}-F(\sqrt{x})G(\sqrt{x})\\
						& = 2\sqrt{x}\sum_{n\leq \sqrt{x}}\dfrac{\chi(n)}{n}+D\cdot F(\sqrt{x})+C\cdot G(\sqrt{x})+O(1)-F(\sqrt{x})G(\sqrt{x})
				\end{align*}
			Note that $ab-ac-bd =(b-c)(a-d)-cd$. Setting $a:=F(\sqrt{x}),b:=G(\sqrt{x})$, we see that
				\begin{align*}
					F(\sqrt{x})G(\sqrt{x})-D\cdot F(\sqrt{x})-C\cdot G(\sqrt{x})
						& = O(1)+\bigo{\dfrac{1}{\sqrt{x}}}
				\end{align*}
			Taking $x\to\infty$, we have
				\begin{align*}
					\lim_{x\to\infty}\Upsilon(x)
					& = 2\sqrt{x}\sum_{n\leq \sqrt{x}}\dfrac{\chi(n)}{n}+O(1)\\
					& = 2\sqrt{x}L(1,\chi)+O(1)
				\end{align*}
			If $L(1,\chi)=0$, then $\lim_{x\to\infty}\Upsilon(x^{2})=O(1)$ which is impossible since $\Upsilon(x)\to\infty$ as $x\to\infty$. Therefore, we must have $L(1,\chi)\neq0$.
		\end{proof}

		\begin{lemma}
			For real $\epsilon, t$ such that $0<\epsilon<1$,
				\begin{align*}
					(1-\epsilon)^{3}|1-\epsilon e^{it}|^{4}|1-\epsilon e^{2it}|^{2}<1
				\end{align*}
		\end{lemma}

		\begin{proof}
			Since $|z|^{2}=z\bar{z}$ and $e^{ix}=\cos{x}+i\sin{x}$, $1-\epsilon e^{it}=1-\epsilon\cos{t}-i\epsilon\sin{t}$.
				\begin{align*}
					|1-\epsilon e^{it}|^{2}
						& = (1-\epsilon\cos{t})^{2}+\epsilon^{2}\sin^{2}{t}\\
						& = 1-2\epsilon\cos{t}+\epsilon^{2}
				\end{align*}
			Similarly, $1-\epsilon e^{2it}=1-\epsilon\cos{2t}-i\epsilon\sin{2t}$, and
				\begin{align*}
					|1-\epsilon e^{2it}|^{2}
						& = 1-2\epsilon\cos{2t}+\epsilon^{2}
				\end{align*}
			From the arithmetic-geometric mean inequality,
				\begin{align*}
					|1-\epsilon e^{it}|^{2}|1-\epsilon e^{it}|^{2}|1-\epsilon e^{2it}|^{2}
						& \leq \parenthesis{1-\dfrac{2}{3}\epsilon(2\cos{t}+\cos{2t})+\epsilon^{2}}^{3}
				\end{align*}
			Now, $2\cos{x}+\cos{2x}\geq-3/2$ due to
				\begin{align*}
					2\cos{x}+\cos{2x}
						& =-\dfrac{3}{2}+2\parenthesis{\cos{t}+\dfrac{1}{2}}^{2}
				\end{align*}
			Thus,
				\begin{align*}
					|1-\epsilon e^{it}|^{4}|1-\epsilon e^{2it}|^{2}
						& \leq (1+\epsilon+\epsilon^{2})^{3}\\
						& = \dfrac{1}{(1-\epsilon)}^{3}
				\end{align*}
			This proves the claim.
		\end{proof}

		\begin{lemma}
			For $s>1$,
				\begin{align*}
					L(s, \chi_{0})^{3}|L(s, \chi)|^{4}|L(s, \chi^{2})|^{2}
						& \geq 1
				\end{align*}
		\end{lemma}

		\begin{proof}
			We can write characters as $\chi=\zeta^{i}$ for some $0\leq i<k$ where $\zeta$ is a complex root of unity. Then $\chi(p)=e^{it}$ for some real $t$. Take prime $p$ such that $p\nmid k$. Setting $\epsilon=1/p^{s}$,
				\begin{align*}
					\parenthesis{1-\dfrac{\chi_{0}(p)}{p^{s}}}^{3}\abslarge{1-\dfrac{\chi(p)}{p^{s}}}^{4}\abslarge{1-\dfrac{\chi^{2}(p)}{p^{s}}}^{2}
						& \leq 1
				\end{align*}
			If $p\mid k$, then we have equality. Then we see that the claim is true since
				\begin{align*}
					L(s, \chi)
						& = \prod_{p}\parenthesis{1-\dfrac{\chi(p)}{p^{s}}}^{-1}
				\end{align*}
		\end{proof}

		\begin{proposition}
			$L(1, \chi)\neq0$ for a non-principal character $\chi$.
		\end{proposition}

		\begin{proof}
			We have already showed this for $\chi$ of the second kind. If $\chi$ is of the third kind, notice that $\chi^{2}$ is also a non-principal character. Because if $\chi^{2}=1$, then $\chi\in\{1,-1\}$ which would make $\chi$ real. Using \autoref{prop:lsumlimited},
				\begin{align*}
					|L(s, \chi)|
						& = \sum_{n\geq1}\dfrac{\chi(n)}{n^{s}}\\
						& \leq \sum_{n\geq 1}\chi(n)\\
						& \leq\varphi(k)
				\end{align*}
			For $1<s<2$,
				\begin{align*}
					L(s, \chi_{0})
						& \sum_{n\geq1}\dfrac{\chi_{0}(n)}{n^{s}}\\
						& = \sum_{\substack{n\geq1\\\gcd(n,k)=1}}\dfrac{1}{n^{s}}\\
						& < 1+\sum_{n\geq1}\dfrac{1}{n^{s}}\\
						& < \dfrac{s}{s-1}\\
						& < \dfrac{2}{s-1}
				\end{align*}
			Then $|L(s, \chi_{0})|^{3}<8/(s-1)^{3}$. If $L(1, \chi)=0$ indeed holds,
				\begin{align*}
					|L(s, \chi)|
						& = |L(s, \chi)-L(1, \chi)|\\
						& = \abslarge{\int_{1}^{s}L'(t, \chi)dt}\\
						& < (s-1)\varphi(k)
				\end{align*}
			Multiplying them, we have for $1<s<2$ and using $|L(s, \chi^{2})|<\varphi(k)$,
				\begin{align*}
					|L(s, \chi)|^{4}L(s, \chi_{0})^{3}|L(s, \chi^{2})|^{2}
						& < (s-1)^{4}\varphi(k)^{4}\dfrac{8}{(s-1)^{3}}\varphi(k)^{2}
				\end{align*}
			By the lemma, $|L(s, \chi)|^{4}L(s, \chi_{0})^{3}|L(s, \chi^{2})|^{2}\geq1$, so for all $1<s<2$,
				\begin{align*}
					8(s-1)\varphi(k)^{6}
						& > 1
				\end{align*}
			For $k>2$, $\varphi(k)>1$, so setting
				\begin{align*}
					s
						&:=1+\dfrac{1}{8\varphi(k)^{6}}
				\end{align*}
			which still satisfies $1<s<2$, we get $1>1$ which is impossible. Thus, $L(1, \chi)\neq0$ cannot hold.
		\end{proof}

		\begin{proposition}
			If $s>1$,
				\begin{align*}
					L'(s,\chi)
						& = -\sum_{i\geq1}\dfrac{\chi(i)\log{i}}{i^{s}}
				\end{align*}
			and $L'(s, \chi)$ converges.
		\end{proposition}

		\begin{proof}
			It is a straightforward differentiation $d a^{-s}=(-a^{-s}\log{a})da$. Next, we show that the absolute value of $L'(s,\chi)$ is bounded above for $s=1+\epsilon$ where $\epsilon>0$.
				\begin{align*}
					\sum_{i\geq1}\abslarge{\dfrac{\chi(i)\log{i}}{i^{s}}}
						& = \sum_{i\geq1}|\chi(i)|\abslarge{\dfrac{\log{i}}{i^{s}}}\\
						& = \sum_{i\geq1}\abslarge{\dfrac{\log{i}}{i^{s}}}\\
						& \leq \sum_{i\geq1}\dfrac{\log{i}}{i^{1+\epsilon}}
				\end{align*}
			We leave it as an exercise to show that
				\begin{align*}
					\sum_{i\geq1}\dfrac{\log{i}}{i^{1+\epsilon}}
				\end{align*}
			diverges if $\epsilon=0$ and converges if $\epsilon>0$.
		\end{proof}

	\section{First Proof of Legendre-Dirichlet Theorem}
	We already discussed that we want to use the fact that the sum of reciprocals of primes diverges. If there are indeed infinitely many primes of the form $kn+l$ for $\gcd(k,l)=1$, we expect that
		\begin{align*}
			\lim_{x\to\infty}\sum_{\substack{p\leq x\\p\equiv l\pmod{k}}}\dfrac{1}{p}
				& \to\infty
		\end{align*}
	We already know that
		\begin{align*}
			\lim_{x\to\infty}\sum_{p\leq x}\dfrac{1}{p}
				& = \log{\log{x}}
		\end{align*}
	Another similar result we established is
		\begin{align}
			\lim_{x\to\infty}\sum_{p\leq x}\dfrac{\log{p}}{p}
			& = \log{x}\label{eqn:logp/p}
		\end{align}
	This actually gives us more room to work with because we can see that this sum is very closely related to
		\begin{align*}
			\lim_{x\to\infty}\sum_{n\leq x}\dfrac{\Lambda(n)}{n}
		\end{align*}
	This expression is not quite the same as the left side of \eqref{eqn:logp/p}. In fact,
		\begin{align*}
			\sum_{n\leq x}\dfrac{\Lambda(n)}{n}
				& = \sum_{p\leq x}\dfrac{\log{p}}{p}+\sum_{p\leq x}\log{p}\sum_{i\geq2}\dfrac{1}{p^{i}}\\
				& = \sum_{p\leq x}\dfrac{\log{p}}{p}+\sum_{p\leq x}\dfrac{\log{p}}{p(p-1)}
		\end{align*}
	Now since
		\begin{align*}
			\sum_{p\leq x}\dfrac{\log{p}}{p(p-1)} & < \sum_{n\leq x}\dfrac{\log{n}}{n(n-1)}
		\end{align*}
	which obviously converges, we can see $\sum_{n\leq x}\frac{\Lambda(n)}{n}\to\infty$ and $\sum_{p\leq x}\frac{\log{p}}{p}\to\infty$ are equivalent and one would imply the other. It will be enough to prove the same with the additional constraint that $p$ must be of the form $kn+l$. We can actually consider the more general sum
		\begin{align*}
			\sum_{\substack{n\leq x\\n\equiv l\pmod{k}}}\dfrac{\Lambda(n)}{n^{s}}
		\end{align*}
	and then take $s\to1$. Furthermore,
		\begin{align*}
			\sum_{p\leq x}\dfrac{\log{p}}{p}
				& = \sum_{\substack{1\leq l\leq k\\\gcd(l,k)=1}}\sum_{\substack{p\leq x\\p\equiv l\pmod k}}\dfrac{\log{p}}{p}
		\end{align*}
	So, if we assume for the time now that the distribution of primes $\pmod{k}$ is uniform, meaning any choice $l$ prime to $k$ yields the same number of primes when $x\to\infty$, we expect that
		\begin{align*}
			\lim_{x\to\infty}\sum_{\substack{p\leq x\\p\equiv l\pmod k}}\dfrac{\log{p}}{p}
				& = \dfrac{1}{\varphi(k)}\lim_{x\to\infty}\sum_{p\leq x}\dfrac{\log{p}}{p}
		\end{align*}
	since there are $\varphi(k)$ such $l$ for which $\gcd(k,l)=1$.

	Next, we should contemplate how we can restrict the primes in the sum $\sum_{p\leq x}\frac{\log{p}}{p}$ to only primes of the form $kn+l$. Here we can see how the characters come into the whole equation using \autoref{prop:moduluscharacter}. But before doing that if we recall $\log{n}=\sum_{d\mid n}\Lambda(n)$, there should be some connection between sums $\sum_{n\geq1}\frac{\log{n}}{n^{s}}$, $\sum_{p\leq x}\frac{\log{p}}{p}$ and $\sum_{n\geq1}\frac{\Lambda(n)}{n^{s}}$. In fact, we have a better connection due to $L'(s,\chi)$ which even involves $\chi$.
		\begin{proposition}
			For a complex $s$ and a character $\chi$,
				\begin{align*}
					\sum_{n\geq1}\dfrac{\chi(n)\Lambda(n)}{n^{s}}
						& = -\dfrac{L'(s, \chi)}{L(s, \chi)}
				\end{align*}
		\end{proposition}

		\begin{proof}
			This is actually quite straightforward using the definitions and Dirichlet product.
				\begin{align*}
					L(s,\chi)\sum_{n\geq1}\dfrac{\chi(n)\Lambda(n)}{n^{s}}
						& = \sum_{n\geq1}\dfrac{\chi(n)}{n^{s}}\sum_{n\geq1}\dfrac{\chi(n)\Lambda(n)}{n^{s}}\\
						& = \sum_{n\geq1}\dfrac{\chi(n)}{n^{s}}\sum_{d\mid n}\Lambda(n)\\
						& = \sum_{n\geq1}\dfrac{\chi(n)\log{n}}{n^{s}}\\
						& = -L'(s,\chi)
				\end{align*}
		\end{proof}

		\begin{proposition}
			If $\chi$ is the principal character, then $\frac{L'(s, \chi)}{L(s, \chi)}$ converges if $s>1$ and it diverges if $s\to1$.
		\end{proposition}

		\begin{proof}
			For $s>1$, the proof is straightforward once we notice that $|\chi(n)\Lambda(n)|\leq\log{n}$. For $s\to1$,
				\begin{align*}
					-\dfrac{L'(s, \chi)}{L(s, \chi)}
						& = \sum_{n\geq1}\dfrac{\Lambda(n)}{n}
				\end{align*}
			We have already shown that the divergence of $\sum_{n\leq x}\frac{\Lambda(n)}{n}$ and $\sum_{p\leq x}\frac{\log{p}}{p}$ are equivalent.
		\end{proof}

		\begin{proposition}
			If $\chi$ is not the principal character, $\frac{L'(s, \chi)}{L(s, \chi)}$ converges for $s>1$.
		\end{proposition}
	We omit the proof since it is straightforward at this stage. The stage is now set to finally prove Legendre's conjecture. Now we simply filter the sums related to $L(s, \chi)$ and $L'(s, \chi)$ to sieve out the primes of the form $kn+l$.
		\begin{proposition}\label{prop:filtermodulus}
			Let $l$ be relatively prime to $k$. Then
				\begin{align*}
					-\sum_{\chi}\dfrac{1}{\chi(l)}\dfrac{L'(s, \chi)}{L(s, \chi)}
						& = \varphi(k)\sum_{\substack{n\geq1\\n\equiv l\pmod{k}}}\dfrac{\Lambda(n)}{n^{s}}
				\end{align*}
			where $\chi$ runs over all the characters of $k$.
		\end{proposition}

		\begin{proof}
			We will use the expansion of $\frac{L'(s, \chi)}{L(s, \chi)}$ along with \autoref{prop:moduluscharacter}.
				\begin{align*}
					-\sum_{\chi}\dfrac{1}{\chi(l)}\dfrac{L'(s, \chi)}{L(s, \chi)}
						& = -\sum_{\chi}\dfrac{1}{\chi(l)}\sum_{n\geq1}\dfrac{\chi(n)\Lambda(n)}{n^{s}}\\
						& = \sum_{n\geq1}\dfrac{\Lambda(n)}{n^{s}}\sum_{\chi}\dfrac{\chi(n)}{\chi(l)}\\
						& = \sum_{\substack{n\geq1\\n\equiv l\pmod{k}}}\varphi(k)\dfrac{\Lambda(n)}{n^{s}}\\
						& = \varphi(k)\sum_{\substack{n\geq1\\n\equiv l\pmod{k}}}\dfrac{\Lambda(n)}{n^{s}}
				\end{align*}
		\end{proof}

		\begin{theorem}[Dirichlet's Theorem on Arithmetic Progressions]\label{thm:dirichletprime}
			For any $l$ prime to $k$, there are infinitely many primes of the form $kn+l$.
		\end{theorem}

		\begin{proof}
			Take $s\to1$ such that $s=1+\epsilon$ for $\epsilon>0$.
				\begin{align*}
					-\sum_{\chi}\dfrac{1}{\chi(l)}\dfrac{L'(s, \chi)}{L(s, \chi)}
						& = \varphi(k)\sum_{\substack{n\geq1\\n\equiv l\pmod{k}}}\dfrac{\Lambda(n)}{n^{s}}
				\end{align*}
			On the left side, if $\chi$ is of the first kind, then $\frac{L'(s, \chi)}{L'(s, \chi)}\to\infty$ for $s\to1$. Otherwise, $\frac{L'(s, \chi)}{L(s, \chi)}$ is finite. Thus, the left side is not bounded, hence, neither is the right side.
				\begin{align*}
					\sum_{\substack{n\geq1\\n\equiv l\pmod{k}}}\dfrac{\Lambda(n)}{n^{s}}
						& = \lim_{x\to\infty}\sum_{\substack{p^{i}\leq x\\p\equiv l\pmod{k}}}\dfrac{\log{p}}{p^{is}}
				\end{align*}
			We divide the primes that appear in the sum in two parts based on whether $i=1$ or $i>1$. For $i>1, n\geq1$ and $s\to1$ from the right side, $n^{is}>n^{i}$ and $\frac{n}{2}<n$.
				\begin{align*}
					\sum_{p^{i}\equiv l\pmod{k}}\dfrac{\log{p}}{p^{is}}
						& < \sum_{n\geq1}\dfrac{\log{n}}{n^{is}}\\
						& < \sum_{n\geq 1}\dfrac{\log{n}}{n^{i}}\\
						& = \sum_{n\geq2}\log{n}\sum_{i\geq2}\dfrac{1}{n^{i}}\\
						& = \sum_{n\geq 2}\dfrac{\log{n}}{n(n-1)}\\
						& < 2\sum_{n\geq 2}\dfrac{\log{n}}{n^{2}}
				\end{align*}
			Since the last sum converges,
				\begin{align*}
					\lim_{x\to\infty}\sum_{\substack{i\geq 2\\p^{i}\leq x\\p\equiv l\pmod{k}}}\dfrac{\log{p}}{p^{is}}
						& = O(1)
				\end{align*}
			Therefore,
				\begin{align*}
					\lim_{x\to\infty}\sum_{\substack{p^{i}\leq x\\p\equiv l\pmod{k}}}\dfrac{\log{p}}{p^{is}}
						& \to\infty\\
					\lim_{x\to\infty}\sum_{\substack{p\leq x\\p\equiv l\pmod{k}}}\dfrac{\log{p}}{p^{s}}+\lim_{x\to\infty}\sum_{\substack{i\geq 2\\p^{i}\leq x\\p\equiv l\pmod{k}}}\dfrac{\log{p}}{p^{is}}
						& \to\infty\\
					\lim_{x\to\infty}\sum_{\substack{p\leq x\\p\equiv l\pmod{k}}}\dfrac{\log{p}}{p^{s}}+O(1)
						& \to\infty\\
					\lim_{x\to\infty}\sum_{\substack{p\leq x\\p\equiv l\pmod{k}}}\dfrac{\log{p}}{p^{s}}
						& \to\infty
				\end{align*}
			Thus, there must be an infinite number of such $p\equiv l\pmod{k}$. Otherwise the sum would also be finite.
		\end{proof}

		\begin{note}
			It may not be apparent at first where we used the fact $L(1, \chi)\neq0$. Do ponder on it in case you missed that we did not state it explicitly. But it is still a necessary prerequisite for this proof to work.
		\end{note}
	\section{Second Proof by Selberg}
	Today there are many variations of the proof of Dirichlet's theorem on arithmetic progressions. But most proofs essentially have the same core idea. A much lesser known and studied proof due to \textcite{selberg_1949} has a little different approach to it. The idea itself is primarily a modification of \textit{Selberg's asymptotic formula} which will be discussed heavily in \autoref{sec:fundamentallemma}. In the last proof, we tried to connect sums of prime powers of the form $kn+l$ with another sum that would not converge. Then we separated the primes only so that the prime powers that are at least squares contribute only to a convergent sum. Selberg's proof does something similar except instead of using the divergence of $L$ series, he used a characteristic function for product of at most two prime powers. Here, we will lay the foundation of Selberg's asymptotic formula and we will prove the actual formula that will be used to prove the prime number theorem later.

	For a real $x$, let
		\begin{align*}
			\lambda_{d}(x)
				& = \mu(d)\log^{2}{\frac{x}{d}}
		\end{align*}
	and $\phi$ be the summatory function of $\lambda$,
		\begin{align*}
			\phi_{n}(x)
			& = \sum_{d\mid n}\lambda_{d}(x)
		\end{align*}

		\begin{lemma}
			We have
				\begin{align*}
					\phi_{n}(x)
						& =
							\begin{cases}
								\log^{2}{x}& \mbox{ if }n=1\\
								\log{p}\log^{2}{\frac{x}{p}}& \mbox{ if }n=p^{u}\\
								2\log{p}\log{q}& \mbox{ if } n=p^{u}q^{v}\\
								0& \mbox{ otherwise}
							\end{cases}
				\end{align*}
			where $p,q$ are distinct primes and $u,v$ are positive integers.
		\end{lemma}

		\begin{proof}
			Assume that $n$ is square-free. If $n=p_{1}\cdots p_{r}$ for distinct primes $p_{1},\ldots,p_{r}$,
				\begin{align}
					\phi_{n}(x)
						& = \phi_{n/p_{i}}(x)-\phi_{n/p_{i}}(x/p_{i})\label{eqn:thetan}
				\end{align}
			Then by induction, the claim follows. If $n=p_{1}^{u_{1}}\cdots p_{r}^{u_{r}}$, then we can either resort to induction or simply notice that \eqref{eqn:thetan} is independent of $u_{i}$.
		\end{proof}
	This $\phi$ can be considered a characteristic function for numbers with at most two distinct prime factors much like Mangoldt's $\Lambda$. However, $\phi$ is also dependent on $x$. Although, we can consider a generalization of von Mangoldt function. We know that $\log{n}=\sum_{d\mid n}\Lambda(d)$. From M\"{o}bius inversion,
		\begin{align*}
			\Lambda(n)
				& = \sum_{d\mid n}\mu(d)\log{\frac{n}{d}}
		\end{align*}
	This representation enables us to define the generalization.
		\begin{definition}[Generalized von Mangoldt Function]
			The $r$-th von Mangoldt function $\Lambda_{r}(n)$ for a non-negative integer $r$ and positive integer $n$ is
				\begin{align*}
					\Lambda_{r}(n)
						& = \sum_{d\mid n}\mu(d)\log^{r}{\frac{n}{d}}
				\end{align*}
		\end{definition}
	We can replace $\log$ with an arbitrary arithmetic function $f$ that has the same property as logarithm $f(mn)=f(m)+f(n), f(m/n)=f(m)-f(n)$ and consider the summatory function
		\begin{align}
			F_{r}(n)
				& = \sum_{d\mid n}\mu(d)\func{f^{m}}{\frac{n}{d}}\label{eqn:genmangold}
		\end{align}
	We leave the following generalization as an exercise.
		\begin{proposition}
			If $n$ has exactly $r$ prime divisors, then with the notations in \eqref{eqn:genmangold},
				\begin{align*}
					F_{r}(n)
						& = r!\prod_{p^{e}\|n}\parenthesis{f(p^{e})-f(p^{e-1})}
				\end{align*}
			where $p^{e}\|n$ denotes $p^{e}\mid n$ but $p^{e+1}\nmid n$.
		\end{proposition}
	For the rest of the section, $\chi$ is a character of the second kind. When $\gcd(k,l)=1$,
		\begin{align*}
			\sum_{\substack{n\leq x\\n\equiv l\pmod{k}}}\phi_{n}(x)
				& = +\bigo{\log^{2}{x}}+\sum_{\substack{p^{u}\leq x\\p^{u}\equiv l\pmod{k}}}\phi_{p^{u}}(x)+\sum_{\substack{p^{u}q^{v}\leq x\\p^{u}q^{v}\equiv l\pmod{k}}}\phi_{p^{u}q^{v}}(x)\\
				& = \bigo{\log^{2}{x}}+\sum_{\substack{p^{u}\leq x\\p^{u}\equiv l\pmod{k}}}\log{p}\log{\frac{x^{2}}{p}}+\sum_{\substack{p^{u}q^{v}\leq x\\p^{u}q^{v}\equiv l\pmod{k}}}\log{p}\log{q}
		\end{align*}
	Here, we are not actually omitting the factor $2$. Rather we are simply considering that the contribution from $p^{u}q^{v}$ is $2\log{p}\log{q}$ whereas $q^{v}p^{u}$ is $0$ since both are actually same even though by order only which does not matter. So instead we can simply consider it as if both $p^{u}q^{v}$ and $q^{v}p^{u}$ contribute $\log{p}\log{q}$ which actually makes our calculation easier while keeping the total invariant. Again, we will treat $u=1$ and $u>1$ separately.
		\begin{align*}
			\sum_{\substack{p^{u}\leq x\\p^{u}\equiv l\pmod{k}}}\log{p}\log{\frac{x^{2}}{p}}
				& = \sum_{\substack{p\leq x\\p\equiv l\pmod{k}}}\log{p}\log{\frac{x^{2}}{p}}+\sum_{\substack{p^{u}\leq x,u\geq2\\p^{u}\equiv l\pmod{k}}}\log{p}\log{\frac{x^{2}}{p}}
		\end{align*}
	You can probably guess by now that the reason we treat them separately is because largest contribution towards the sum is made by the $p\leq x$ rather than $p^{2}\leq x,p^{3}\leq x,\ldots$ since they are much rarer.
		\begin{align*}
			\sum_{\substack{p\leq x\\p\equiv l\pmod{k}}}\log{p}\log{\frac{x^{2}}{p}}
				& = \sum_{\substack{p\leq x\\p\equiv l\pmod{k}}}\log{p}(2\log{x}-\log{p})\\
				& = 2\sum_{\substack{p\leq x\\p\equiv l\pmod{k}}}\log{p}\log{\frac{x}{p}}+\sum_{\substack{p\leq x\\p\equiv l\pmod{k}}}\log^{2}{p}
		\end{align*}
	Using partial summation, $\sum_{p\leq x}\log^{2}{p}=\parenthesis{\sum_{p\leq x}\log{p}}\log{x}-\int_{2}^{x}\frac{\vartheta(t)}{t}dt$.
		\begin{align*}
			\sum_{p\leq x}\log{p}\log{\frac{x}{p}}
				& = \parenthesis{\sum_{p\leq x}\log{p}}\log{x}-\sum_{p\leq x}\log^{2}{p}\\
				& = \vartheta(x)\log{x}-\sum_{p\leq x}\log^{2}{p}\\
				& = \int_{2}^{x}\dfrac{\vartheta(t)}{t}dt\\
				& = O(x)
		\end{align*}
	since we already know from Tchebyscheff's theorems that $\vartheta(x)=O(x)$ and $\psi(x)=O(x)$. Thus,
		\begin{align*}
			\sum_{\substack{p\leq x\\p\equiv l\pmod{k}}}\log{p}\log{\frac{x^{2}}{p}}
				& = \sum_{\substack{p\leq x\\p\equiv l\pmod{k}}}\log^{2}{p}+O(x)
		\end{align*}
	For $u\geq2$,
		\begin{align*}
			\sum_{\substack{p^{u}\leq x,u\geq2\\p^{u}\equiv l\pmod{k}}}\log{p}\log{\frac{x^{2}}{p}}
				& \leq 2\bigl(\sum_{p\leq \sqrt{x}}\log{p}\bigr)\log{x}\\
				& \leq 2\pi(\sqrt{x})\log^{2}{x}\\
				& = \bigo{\dfrac{\sqrt{x}}{\log{x}}}\log^{2}{x}\\
				& = \bigo{\sqrt{x}\log{x}}
		\end{align*}
	Next, for when $u\geq2$ and $n=p^{u}q^{v}$,
		\begin{align*}
			\sum_{\substack{p^{u}q^{v}\leq x\\u\geq2\\p^{u}q^{v}\equiv l\pmod{k}}}\log{p}{\log{q}}
				& \leq \sum_{\substack{p^{u}q^{v}\leq x\\u\geq2}}\log{p}{\log{q}}\\
				& = \sum_{\substack{p^{u}\leq x\\u\geq 2}}(\log{p})\sum_{q^{v}\leq x/p^{u}}\log{q}\\
				& = \sum_{\substack{p^{u}\leq x\\u\geq 2}}(\log{p})\parenthesis{\log_{q}{\floor{\frac{x}{p^{u}}}}\log{q}}
		\end{align*}
	Using $\log_{a}{b}\log{b}{c}=\log_{a}{c}$,
		\begin{align*}
			\sum_{\substack{p^{u}q^{v}\leq x\\u\geq2\\p^{u}q^{v}\equiv l\pmod{k}}}\log{p}{\log{q}}
				& = \sum_{\substack{p^{u}\leq x\\u\geq 2}}\log{p}\log{{\floor{\frac{x}{p^{u}}}}}\\
				& = \bigo{x\sum_{\substack{p^{u}\leq x\\u\geq 2}}\dfrac{\log{p}}{p^{u}}}\\
				& = \bigo{x\sum_{p\leq x}\dfrac{\log{p}}{p(p-1)}}
		\end{align*}
	Again, $\sum\frac{\log{p}}{p(p-1)}$ converges, so the sum is simply $O(x)$. Combining all of these,
		\begin{align*}
			\sum_{\substack{n\leq x\\n\equiv l\pmod{k}}}\phi_{n}(x)
				& = \sum_{\substack{p\leq x\\p\equiv l\pmod{k}}}\log^{2}{p}+\sum_{\substack{pq\leq x\\pq\equiv l\pmod{k}}}\log{p}{\log{q}}+O(x)
		\end{align*}
\end{document}